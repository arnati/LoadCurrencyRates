# Загрузка курсов валют из ЦБ РФ (УТ 11.5)

---

## Описание задачи
**Внешняя обработка** для ** 1С:УТ 11.5**, автоматически получающая **курсы валют с API ЦБ РФ** на заданную дату. Позволяет **загружать курсы в регистр сведений "Курсы валют"**, поддерживает **фильтрацию по валютам** и **автоматическое обновление по расписанию**.

---

## Исходные данные
- **Платформа**: 1С:Предприятие 8.3.27.
- **Редакция УТ**: 11.5.11.70.
- **Источник данных**: API ЦБ РФ ([документация](http://www.cbr.ru/development/SXML/)).
- **Формат данных**: XML (пример: [XML_daily.asp](https://www.cbr.ru/scripts/XML_daily.asp)).

---

## Возможности

### 1. Получение курсов валют
- Пользователь выбирает дату, на которую необходимо получить курсы.
- Обработка формирует GET-запрос к API ЦБ РФ и загружает данные в формате XML.
- Курсы отображаются в таблице на форме для предварительного просмотра.

### 2. Фильтрация и запись данных
- **Фильтрация по валютам**: пользователь может выбрать, какие валюты загружать.
- **Запись в регистр сведений**: курсы сохраняются в регистр **"Курсы валют"** по команде **"Загрузить"**.
- **Создание новых валют**: если валюта не найдена в справочнике, обработка может создать новую запись (опционально).

### 3. Автоматическая загрузка по расписанию
- Поддерживается настройка автоматической загрузки курсов по расписанию:
  - Ежедневное обновление курса доллара.
  - Еженедельное обновление всех валют.

---

## Особенности реализации
- **Клиент-серверная архитектура**: логика разделена на клиентскую и серверную части.
- **Работа с API ЦБ РФ**: данные загружаются с официального источника.
- **Обработка XML**: парсинг ответа от ЦБ РФ и сопоставление данных с реквизитами таблицы.
- **Валидация данных**: проверка корректности полученных курсов перед записью.
- **Условное оформление**: подсветка ошибок и некорректных данных.

---

## Команды обработки

| Команда                          | Описание                                                                 |
|----------------------------------|--------------------------------------------------------------------------|
| **Загрузить курсы валют**        | Загружает курсы всех валют на выбранную дату.                           |
| **Загрузить только курс доллара**| Загружает только курс доллара (USD) на выбранную дату.                  |
| **Выбрать валюты вручную**       | Позволяет выбрать конкретные валюты для загрузки.                       |

---

## Демонстрация работы
https://github.com/user-attachments/assets/ac955fff-7902-4650-b28a-7d0a8612264e

---

## Как использовать
1. **Подключение обработки**:
   - Подключите обработку через подсистему БСП **"Дополнительные отчеты и обработки"**.

2. **Получение курсов**:
   - Выберите дату, на которую необходимо получить курсы.
   - Нажмите **"Загрузить курсы валют"** — данные отобразятся в таблице.

3. **Фильтрация и запись**:
   - Выберите нужные валюты (или оставьте все).
   - Нажмите **"Загрузить"** — курсы сохранятся в регистр **"Курсы валют"**.

4. **Автоматическая загрузка**:
   - Настройте расписание для автоматического обновления курсов (например, ежедневное обновление доллара).

---

## Результаты
- Автоматизация получения курсов валют из официального источника.
- Снижение ручного труда и ошибок при вводе данных.
- Гибкая настройка загрузки (по расписанию или вручную).
